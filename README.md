# Unit Economics Calculator (Ювелирный бренд + студия йоги + магазин)

Гибкая CLI-модель и веб-форма, которые считают P&L по трём направлениям (ювелирный премиум-магазин, студия йоги/"храм состояний", магазин сопутствующих товаров), а также общий результат с учётом налога на прибыль.

## Быстрый старт (CLI)
1. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
2. Отредактируйте входной файл (пример: `config.example.json`) под свои допущения: цены, объёмы, загрузку, ставки комиссий, фиксированные расходы, модель вознаграждения тренеров и B2B-дни.
3. Запустите расчёт:
   ```bash
   python calculator.py --config config.example.json
   ```
4. На выходе — JSON с деталями по каждому направлению (выручка, переменные/фиксированные расходы, вклад в маржу, прибыль до/после налога) и ключевые KPI (break-even по штукам/заполняемости).

## Веб-форма ввода/вывода
1. Установите зависимости (если не делали выше):
   ```bash
   pip install -r requirements.txt
   ```
2. Запустите веб-приложение:
   ```bash
   FLASK_APP=web_app.py flask run --host=0.0.0.0 --port=8000 --reload
   ```
   или напрямую:
   ```bash
   python web_app.py
   ```
3. Откройте в браузере `http://localhost:8000` — там будет форма с JSON-конфигурацией (предзаполнена из `config.example.json`). Статическая HTML-версия находится в `templates/index.html`, её можно открывать отдельно или переиспользовать в другом приложении.
4. Измените значения прямо в форме и нажмите «Рассчитать», чтобы увидеть результат в блоке «Результат» на той же странице.

## Структура конфигурации
Все цифры — помесячно (если не оговорено иное). Ставки и доли задаются в долях (0.22 = 22%).

### Общие параметры
```json
{
  "currency": "RUB",
  "tax": { "profit_tax_rate": 0.22 }
}
```

### Ювелирный бизнес (`jewelry`)
- `channels`: список каналов. Для каждого: `name`, `units`, `avg_price`, `unit_cost`, `discount_rate`, `return_rate`, `payment_fee_rate`, `channel_fee_rate`, `variable_ops_cost` (упаковка, логистика и т.п. на единицу).
- `overheads`: любые фиксированные статьи (аренда, ФОТ, маркетинг, страхование и т.д.). Суммируются автоматически.

Результаты: по каждому каналу — вал/нетто выручка, переменные затраты, вклад, маржа на единицу, break-even по штукам; общий P&L ювелирного направления.

### Студия йоги (`yoga`)
- `capacity`: мест в зале.
- `classes`: `slots_per_day`, `days_per_week`, `weeks_per_month` (по умолчанию 4.3), `fill_rate` (средняя заполняемость публичных классов).
- `pricing`: `single_class_price`, `discount_rate`, `corporate_day_rate`, `corporate_variable_cost_rate` (доли переменных на B2B-день).
- `trainer_payout_rate`: доля выручки публичных занятий тренерам.
- `variable_cost_per_attendee`: переменные на ученика (коврики, вода, расходники).
- `payment_fee_rate`: эквайринг для публичных платежей.
- `corporate`: `days_per_month` (сколько дней отдаём под B2B), `public_slots_replaced` (true/false — заменяет ли B2B публичные слоты).
- `overheads`: фиксированные расходы студии (аренда, ФОТ, маркетинг, клининг, коммуналка, страховка и т.д.).

Результаты: раздельно public и B2B, вклад B2B, P&L, break-even fill rate (доля заполняемости зала, необходимая для покрытия фиксированных при текущих ценах и % тренеров, с учётом B2B-вклада).

### Магазин сопутствующих товаров (`retail`)
- `categories`: список категорий. Для каждой: `name`, `units`, `avg_price`, `unit_cost`, `discount_rate`, `return_rate`, `payment_fee_rate`, `channel_fee_rate`, `variable_ops_cost` (упаковка/логистика на ед.).
- `overheads`: фиксированные расходы на розницу.

Результаты: вклад каждой категории и общий P&L по магазину, break-even по штукам.

### Выходные данные
- По каждому сегменту — `pnl` с выручкой, переменными/фиксированными расходами, contribution margin, прибылью до налога, а также KPI break-even.
- `aggregate` — суммарный P&L и налоговая нагрузка (применяется только при положительной прибыли).

## Советы по настройке гибких сценариев
- Дублируйте блоки каналов/категорий, чтобы моделировать новые каналы продаж или коллекции.
- Меняйте `fill_rate`, `trainer_payout_rate`, `corporate`-дни, чтобы увидеть чувствительность студии йоги к загрузке и B2B.
- Используйте `discount_rate` и `return_rate` для проверки акций/возвратов.
- Обновляйте `profit_tax_rate`, если меняется налоговая нагрузка.

## Ограничения
- Модель считает средние месячные показатели; сезонность можно учесть отдельными сценариями/конфигурациями.
- НДС/страховые можно добавить в `overheads` или переменные ставки, если требуется более точный разрез.
